openapi: 3.1.0
info:
  version: 1.0.0
  title: Knot API
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  x-logo:
    url: ../images/knot-logo.webp
  description: >
    # Introduction

    The REST API is used for the CLI, Web interface and 3rd party integrations.

    See [Agent API](/api-docs/agent/) for the agent API.
tags:
  - name: Agents
    description: |
      Operations are for working with agents.
  - name: Authorization
    description: |
      This API is authenticated using a bearer token. The token is passed in the Authorization header as a Bearer token.

      A token can be obtained by logging in with the login endpoint and providing a valid username and password, or by creating a token with the create token endpoint.
  - name: API Tokens
    description: |
      Operations for working with API tokens.
  - name: Core
    description: |
      Core API endpoints.
  - name: Proxy
    description: |
      Endpoints for providing proxy services.
  - name: Spaces
    description: |
      Endpoints for working with spaces.
  - name: Users
    description: |
      These operations are for working with users.

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
    AgentAuth:
      type: http
      scheme: bearer

paths:
  /api/v1/users:
    $ref: paths/users.yaml

  /api/v1/sessions:
    $ref: paths/sessions.yaml
  /api/v1/sessions/{session_id}:
    $ref: paths/sessions_{session_id}.yaml

  /api/v1/auth/web:
    $ref: paths/auth_web.yaml

  /api/v1/tokens:
    $ref: paths/tokens.yaml
  /api/v1/tokens/{token_id}:
    $ref: paths/tokens_{token_id}.yaml

  /api/v1/spaces:
    $ref: paths/spaces.yaml
  /api/v1/spaces/{space_id}:
    $ref: paths/spaces_{space_id}.yaml
  /api/v1/spaces/{space_id}/service-state:
    $ref: paths/spaces_{space_id}_service-state.yaml

  /proxy/port/{host}/{port}:
    $ref: paths/proxy_port_{host}_{port}.yaml

  /api/v1/lookup/{service}:
    $ref: paths/lookup.yaml

  /api/v1/ping:
    $ref: paths/ping.yaml

  /api/v1/agents/{space_id}:
    $ref: paths/agents_{space_id}.yaml
  /agents/{space_id}/status:
    $ref: paths/agents_{space_id}_status.yaml
